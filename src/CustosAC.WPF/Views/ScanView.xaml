<UserControl x:Class="CustosAC.WPF.Views.ScanView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="900">

    <UserControl.Resources>
        <!-- Simple spinner rotation -->
        <Storyboard x:Key="SpinnerAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="SpinnerRotate"
                             Storyboard.TargetProperty="Angle"
                             From="0" To="360" Duration="0:0:1"/>
        </Storyboard>
    </UserControl.Resources>

    <Grid>
        <!-- Ready State -->
        <Grid x:Name="ReadyStateGrid"
              Visibility="{Binding IsReadyToScan, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">

                <!-- Icon -->
                <Border Width="100" Height="100" CornerRadius="50"
                        Background="{StaticResource SurfaceBrush}"
                        HorizontalAlignment="Center" Margin="0,0,0,24">
                    <Border.Effect>
                        <DropShadowEffect Color="#FF6B00" BlurRadius="15" ShadowDepth="0" Opacity="0.25"/>
                    </Border.Effect>
                    <materialDesign:PackIcon Kind="Radar"
                                             Width="45" Height="45"
                                             Foreground="{StaticResource SecondaryBrush}"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"/>
                </Border>

                <!-- Title -->
                <TextBlock Text="{Binding Localization.Strings.Scan}"
                           FontSize="28" FontWeight="Bold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           HorizontalAlignment="Center" Margin="0,0,0,12"/>

                <!-- Description -->
                <TextBlock Text="{Binding Localization.Strings.ScanDescription}"
                           Style="{StaticResource SubtitleStyle}"
                           HorizontalAlignment="Center" Margin="0,0,0,8"
                           TextWrapping="Wrap" TextAlignment="Center" MaxWidth="380"/>

                <!-- Scanner count -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,32">
                    <TextBlock Text="{Binding TotalScanners}"
                               FontSize="14"
                               Foreground="{StaticResource SecondaryBrush}"/>
                    <TextBlock Text=" "
                               FontSize="14"
                               Foreground="{StaticResource SecondaryBrush}"/>
                    <TextBlock Text="{Binding Localization.Strings.ScannersReady}"
                               FontSize="14"
                               Foreground="{StaticResource SecondaryBrush}"/>
                </StackPanel>

                <!-- Start Button -->
                <Button Content="{Binding Localization.Strings.StartScan}"
                        Command="{Binding StartScanCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Width="180"/>
            </StackPanel>
        </Grid>

        <!-- Scanning State -->
        <Grid x:Name="ScanningStateGrid"
              Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">

                <!-- Simple Spinner -->
                <Grid Width="100" Height="100" Margin="0,0,0,20" HorizontalAlignment="Center">
                    <!-- Background circle -->
                    <Border Width="80" Height="80" CornerRadius="40"
                            Background="{StaticResource SurfaceBrush}">
                        <Border.Effect>
                            <DropShadowEffect Color="#FF6B00" BlurRadius="12" ShadowDepth="0" Opacity="0.3"/>
                        </Border.Effect>
                    </Border>

                    <!-- Spinning arc -->
                    <Canvas Width="60" Height="60"
                            HorizontalAlignment="Center" VerticalAlignment="Center"
                            RenderTransformOrigin="0.5,0.5">
                        <Canvas.RenderTransform>
                            <RotateTransform x:Name="SpinnerRotate" Angle="0"/>
                        </Canvas.RenderTransform>
                        <Path Stroke="#FF6B00" StrokeThickness="3" StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                            <Path.Data>
                                <PathGeometry>
                                    <PathFigure StartPoint="30,3">
                                        <ArcSegment Point="57,30" Size="27,27"
                                                    SweepDirection="Clockwise" IsLargeArc="False"/>
                                    </PathFigure>
                                </PathGeometry>
                            </Path.Data>
                        </Path>
                    </Canvas>

                    <!-- Percentage -->
                    <TextBlock Text="{Binding ScanProgress, StringFormat='{}{0:P0}'}"
                               FontSize="14" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               HorizontalAlignment="Center" VerticalAlignment="Center"/>

                    <!-- Start animation -->
                    <Grid.Triggers>
                        <EventTrigger RoutedEvent="Loaded">
                            <BeginStoryboard Storyboard="{StaticResource SpinnerAnimation}"/>
                        </EventTrigger>
                    </Grid.Triggers>
                </Grid>

                <!-- Scanning Text -->
                <TextBlock Text="{Binding Localization.Strings.Scanning}"
                           FontSize="22" FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           HorizontalAlignment="Center"/>

                <!-- Current Scanner -->
                <TextBlock Text="{Binding CurrentScannerName}"
                           FontSize="13"
                           Foreground="{StaticResource SecondaryBrush}"
                           HorizontalAlignment="Center" Margin="0,6,0,0"
                           MinHeight="18"/>

                <!-- Progress Bar -->
                <Grid Width="260" Height="4" Margin="0,16,0,0">
                    <Border CornerRadius="2" Background="#333333"/>
                    <Border CornerRadius="2" HorizontalAlignment="Left"
                            Background="{StaticResource SecondaryBrush}"
                            Width="{Binding ScanProgressWidth}"/>
                </Grid>

                <!-- Progress Text -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <TextBlock Text="{Binding CompletedScanners}"
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                    <TextBlock Text=" / "
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                    <TextBlock Text="{Binding TotalScanners}"
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                    <TextBlock Text=" "
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                    <TextBlock Text="{Binding Localization.Strings.ScannersReady}"
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Subtitle -->
                <TextBlock Text="{Binding Localization.Strings.ScanningSubtitle}"
                           Style="{StaticResource SubtitleStyle}"
                           HorizontalAlignment="Center" Margin="0,12,0,28"/>

                <!-- Cancel Button -->
                <Button Content="{Binding Localization.Strings.CancelScan}"
                        Command="{Binding CancelScanCommand}"
                        Style="{StaticResource CancelButtonStyle}"
                        Width="160"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
